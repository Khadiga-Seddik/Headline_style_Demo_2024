<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <title>Front page</title>
</head>

<body class="front_page_body">

    <!-- ReadLater alert -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>This article already exists in the list</p>
        </div>

    </div>

    <header id="header">
        
        <div class="left_content">

            <div class="read_later_container">
                <div class="dropdown">
                    <button class="dropbtn">
                    </button>
                    <div class="dropdown-content">
                    </div>
                </div>
            </div>

        </div>

        <div class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 173.02 125.73">
                <path
                    d="M35.85 46.51h-3.83L5.62 7.24v39.27h-3.9V.63h3.9l26.4 39.27V.63h3.84ZM72.82 24.51H51.38v18.7h24.64v3.3H47.5V.63h28.38V3.9h-24.5v17.32h21.44ZM92.66 34.1l1.42 7.12 1.73-6.8L105.76.63h3.49l9.83 33.79 1.7 6.86 1.51-7.18L130.57.63h4l-11.78 45.88h-3.71l-10.39-35.9-1.17-4.53-1.13 4.53-10.64 35.9h-3.73L80.32.63h4ZM167.95 35.2a7.42 7.42 0 0 0-2.68-6q-2.67-2.22-9.79-4.22t-10.39-4.36a10.27 10.27 0 0 1-4.66-8.75 10.24 10.24 0 0 1 4.33-8.55A17.8 17.8 0 0 1 155.83.03a18.46 18.46 0 0 1 8.19 1.73 13.42 13.42 0 0 1 5.59 4.92 12.9 12.9 0 0 1 2 7h-3.9a9.63 9.63 0 0 0-3.22-7.57 12.51 12.51 0 0 0-8.62-2.86 13.58 13.58 0 0 0-8.38 2.36 7.32 7.32 0 0 0-3.12 6.13 7 7 0 0 0 2.77 5.77q2.81 2.2 9 3.89a42.34 42.34 0 0 1 9.35 3.5 13.36 13.36 0 0 1 4.79 4.33 10.83 10.83 0 0 1 1.6 6 10.37 10.37 0 0 1-4.32 8.69q-4.33 3.28-11.42 3.28a22.49 22.49 0 0 1-8.9-1.73 13.74 13.74 0 0 1-6.17-4.96 12.57 12.57 0 0 1-2.05-7.13h3.87a9.17 9.17 0 0 0 3.62 7.65q3.63 2.81 9.64 2.8a14.25 14.25 0 0 0 8.6-2.36 7.38 7.38 0 0 0 3.2-6.27ZM25.56 100.51h-9v24.33H.02V56.01h27.05q12.23 0 19.13 5.43t6.89 15.33q0 7.18-2.9 11.9a20.68 20.68 0 0 1-9.09 7.64l14.36 27.77v.71H37.7Zm-9-12.75h10.51q4.73 0 7.11-2.49a9.59 9.59 0 0 0 2.38-6.93 9.72 9.72 0 0 0-2.41-7q-2.4-2.54-7.08-2.53H16.58ZM105.76 95.6H79.69v16.43h30.79v12.76H63.11V56.01h47.47v12.8H79.69v14.51h26.07ZM172.88 101.51a25.08 25.08 0 0 1-3.86 12.67 23.46 23.46 0 0 1-10 8.53 33.93 33.93 0 0 1-14.62 3q-13.54 0-21.35-8.83t-7.79-24.94v-3.4a41.55 41.55 0 0 1 3.52-17.69 26.68 26.68 0 0 1 10.13-11.72 28.31 28.31 0 0 1 15.3-4.13q12.53 0 20.13 6.59t8.68 18.18h-16.53q-.19-6.29-3.17-9t-9.07-2.74q-6.18 0-9.06 4.63c-1.93 3.09-2.93 8-3 14.78v4.87q0 11 2.76 15.73t9.52 4.72c3.81 0 6.73-.9 8.74-2.69s3.09-4.64 3.21-8.55Z" />
            </svg>
        </div>

         <div class="right_content"> 
            <!-- experiment countdown timer -->
            <div class="timer_container">
                <span>Remaining time</span>
                <strong id="timer">-- : --</strong>
            </div>

        </div>
    </header>

    <div class="main_wrapper grid_container">

        {% if article_list_ %}

        {% for x in article_list_ %}
        <!-- News unit -->
        <div class="news_unit grid_item">
            <a>
                <div class="img_container">
                    <img src="{{ x.image_url }}" alt="Uh OH !">
                </div>
                <div class="title_container">
                    <p id="title">{{ x.title }}</p>
                </div>
            </a>
            <div class="actions_container">


                <div class="addTo_readLater"
                    id="{'id':'{{x.id}}','aid':'{{x.aid}}','style':'{{x.style}}'}|{{ x.title }}"
                    onclick="add_to_read_later_list(this.id, '{{selected_style}}')">
                    <span>
                        <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve"
                            style="enable-background:new 0 0 273 269" viewBox="0 0 273 269">
                            <path
                                d="M224.5 160.7v-121c0-9.5-7.3-16.8-16.8-16.8h-168c-9.5 0-16.8 7.3-16.8 16.8v168c0 9.5 7.3 16.8 16.8 16.8h121c6.7 19.6 25.2 33.6 47 33.6 28 0 50.4-22.4 50.4-50.4 0-21.8-14-40.3-33.6-47zM39.7 213.3c-3.4 0-5.6-2.2-5.6-5.6v-168c0-3.4 2.2-5.6 5.6-5.6h168c3.4 0 5.6 2.2 5.6 5.6v118.2c-1.7 0-3.9-.6-5.6-.6-28 0-50.4 22.4-50.4 50.4 0 1.7.6 3.9.6 5.6H39.7zm168 33.6c-21.8 0-39.2-17.4-39.2-39.2s17.4-39.2 39.2-39.2 39.2 17.4 39.2 39.2-17.4 39.2-39.2 39.2zm28-39.2c0 3.4-2.2 5.6-5.6 5.6h-16.8v16.8c0 3.4-2.2 5.6-5.6 5.6-3.4 0-5.6-2.2-5.6-5.6v-16.8h-16.8c-3.4 0-5.6-2.2-5.6-5.6 0-3.4 2.2-5.6 5.6-5.6h16.8v-16.8c0-3.4 2.2-5.6 5.6-5.6 3.4 0 5.6 2.2 5.6 5.6v16.8h16.8c3.4 0 5.6 2.2 5.6 5.6zm-134.4-84c0-3.4 2.2-5.6 5.6-5.6h78.4c3.4 0 5.6 2.2 5.6 5.6 0 3.4-2.2 5.6-5.6 5.6h-78.4c-3.4 0-5.6-2.2-5.6-5.6zm-22.4 0c0 6.2-5 11.2-11.2 11.2s-11.2-5-11.2-11.2 5-11.2 11.2-11.2 11.2 5 11.2 11.2zm0-39.2c0 6.2-5 11.2-11.2 11.2s-11.2-5-11.2-11.2c0-6.2 5-11.2 11.2-11.2s11.2 5 11.2 11.2zm22.4 0c0-3.4 2.2-5.6 5.6-5.6h56c3.4 0 5.6 2.2 5.6 5.6 0 3.4-2.2 5.6-5.6 5.6h-56c-3.4 0-5.6-2.2-5.6-5.6zm-22.4 78.4c0 6.2-5 11.2-11.2 11.2s-11.2-5-11.2-11.2c0-6.2 5-11.2 11.2-11.2s11.2 5 11.2 11.2zm67.2 0c0 3.4-2.2 5.6-5.6 5.6h-33.6c-3.4 0-5.6-2.2-5.6-5.6 0-3.4 2.2-5.6 5.6-5.6h33.6c3.4 0 5.6 2.2 5.6 5.6z" />
                        </svg>
                    </span>
                    <p>Select</p>

                    <div id='correct_selection' class="correct_checkmark"> 
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="#fff"><path d="M20.285 2l-11.285 11.567-5.286-5.011-3.714 3.716 9 8.728 15-15.285z"/></svg>
                        Correct
                    </div>

                    <div id='wrong_selection' class="wrong_checkmark">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="#fff">
                            <path
                                d="M23 20.168l-8.185-8.187 8.185-8.174-2.832-2.807-8.182 8.179-8.176-8.179-2.81 2.81 8.186 8.196-8.186 8.184 2.81 2.81 8.203-8.192 8.18 8.192z" />
                        </svg>
                        Wrong
                    </div>
                </div>
            </div>
        </div>

        {% endfor %}

        {% else %}
        <p> No records found</p>
        {% endif %}
    </div>

    <!-- <div class="description_container">

        <div id="tooltipContent" class="tooltip-content">
            <p class="tooltip-title">Your task:<br>What should I do</p>
            <br><p class="tooltip-desc"> <strong>Review</strong> this personalized front page with headlines from the past 5 to 15 years. <strong>Select</strong> 3 headlines that you find interesting and would like to read the full article of. <br><br> To select an article, press the <strong>"Select"</strong> button. If you change your mind, you can <strong>unselect</strong> an article by pressing the <strong>"Select"</strong> button again. When you are finished selecting articles, proceed by pressing the <strong>"Done"</strong> button.</p>
       
    </div>
    </div> -->

    <div class="button_container">

        <form id="myForm" action="{% url 'front_page' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="next_button" value="">
            <button class="fixed-bottom-right" type="button" onclick="showModal()">
                Done
                <span class="button-subtitle">I am finished selecting articles</span>
            </button>
        </form>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <p>Are you sure you are finished selecting articles?</p>
            <div class="modal-buttons">
                <button type="button" class="btn-lg" onclick="confirmSelection()">Yes</button>
                <button type="button" class="btn-lg" onclick="closeModal()">No</button>
            </div>
        </div>
    </div>  

    <!-- TooMany alert -->
    <div id="tooManyModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>You can only select 3 articles. Please remove one article from your selection if you wish to add another article.</p>
        </div>
    </div>

    <!-- TooFew alert -->
    <div id="tooFewModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Select at least one headline</p>
        </div>
    </div>
        
    <input type="hidden" id="thanksURL" data-url="{% url 'end_page' %}" />
    <input type="hidden" id="readLaterURL" data-url="{% url 'read_later' %}" />
    <input type="hidden" id="feedbackSurveyURL" data-url="{% url 'feedback_survey'}" />
    <input type="hidden" id="removeReadLaterUrl" data-url="{% url 'remove_read_later' %}" />

    <script src="{% static 'js/main.js' %}"></script>
    <script type="text/javascript">

        // When the user scrolls down 50px from the top of the document, resize the header's font size
        const myHeader = document.getElementById("header");
        window.onscroll = function () {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                myHeader.classList.add('shrink');

            } else {
                myHeader.classList.remove('shrink');
            }
            localStorage.setItem('scrollPosition', window.scrollY.toString());
        };

        // this block of code solved Safari's back button problem (When pressing back button, Safari didn't call the front_page view)
        // this solution is to force a reload when page is loaded from bfcache (before cash)
        window.onpageshow = function (event) {
            if (event.persisted) {
                window.location.reload()
            }
        };

        window.onload = function () {

            console.log("onload:");
            loadReadLaterList();
            loadDropdownList();
            loadCounter();
            console.log("loadReadLaterList");
            console.log("loadDropdownList");
            console.log("loadCounter");

            var savedPosition = localStorage.getItem('scrollPosition');
            if (savedPosition) {
                // If a saved position exists, parse it to an integer and scroll to that position
                window.scrollTo(0, parseInt(savedPosition, 10));
            }
        }

        // Show a message telling that you must select three articles
        function showModal() {
            var read_later_articles = localStorage.getItem("read_later_articles") || "";
            var articleCount = read_later_articles.split("||").filter(Boolean).length; // Count the articles

            if (articleCount < 1) {
                // Show article selection alert modal
                var modal = document.getElementById("tooFewModal");
                modal.style.display = "block";

                var span = modal.querySelector(".close");
                span.onclick = function() {
                    modal.style.display = "none";
                };

                // Close the modal if the user clicks outside of it
                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                };
            } else {
                // Proceed with the original "Done" functionality if there's at least one article
                // For example, showing a confirmation modal or submitting the form
                document.getElementById('confirmationModal').style.display = 'block';
                window.onclick = function(event) {
                    if (event.target == confirmationModal) {
                        confirmationModal.style.display = 'none';
                    }
                };
            }
        }

        // JavaScript for the "next" button
        // function showModal() {
        //     document.getElementById('confirmationModal').style.display = 'block';
        // }


        function closeModal() {
            document.getElementById('confirmationModal').style.display = 'none';
        }

        function confirmSelection() {
            closeModal();
            document.getElementById('myForm').submit();
        }

        window.history.pushState(null, "", window.location.href);    
        window.onpopstate = function() {
            window.history.pushState(null, "", window.location.href);
        };

        document.getElementById('descriptionBtn').addEventListener('click', function() {
            var tooltipContent = document.querySelector('.tooltip-content');
            if (tooltipContent.style.display === 'none' || tooltipContent.style.display === '') {
                tooltipContent.style.display = 'block';
            } else {
                tooltipContent.style.display = 'none';
            }
        });

    </script>

</body>

</html>